<!-- cc83b9dd-2509-47e9-bfd4-fdac90cfdbda 10496af0-4839-4df2-8577-d27046f7ad9f -->
# План анализа логов и исправления ошибок

## Выявленные проблемы

### 1. Критическая ошибка: AttributeError в EWS модуле

**Файл:** `digest-core/src/digest_core/ingest/ews.py:65`
**Ошибка:** `'EWSConfig' object has no attribute 'get_ews_password'`

**Причина:**

- В файле `ews.py` на строке 65 вызывается метод `self.config.get_ews_password()`
- Объект `self.config` имеет тип `EWSConfig` (определен в `config.py`)
- В классе `EWSConfig` (строки 18-48) существует только метод `get_password()`, а не `get_ews_password()`
- Метод `get_ews_password()` определен только в главном классе `Config` (строка 151-153)

**Решение:** Заменить вызов `self.config.get_ews_password()` на `self.config.get_password()` в файле `ews.py`

### 2. Проблемы с окружением

**Файл:** `diagnostics-2025-10-12-18-05-32/system/env_diagnostics.txt`

**Выявленные проблемы:**

- Отсутствуют переменные окружения: `EWS_USER_UPN`, `EWS_PASSWORD`, `LLM_TOKEN`, `EWS_ENDPOINT`, `LLM_ENDPOINT`
- Отсутствуют инструменты разработки: `pytest`, `ruff`, `black`
- Корпоративный CA сертификат не найден

**Примечание:** Эти проблемы не являются ошибками кода, но блокируют работу приложения

## Список исправлений

### Исправление кода

**Файл:** `digest-core/src/digest_core/ingest/ews.py`

- **Строка 65:** Заменить `password=self.config.get_ews_password()` на `password=self.config.get_password()`

### Дополнительные рекомендации

1. **Проверить другие вызовы:** Убедиться, что в других местах кода нет аналогичных вызовов несуществующих методов
2. **Добавить тесты:** Создать unit-тесты для проверки методов конфигурации
3. **Улучшить документацию:** Документировать правильные методы доступа к паролям в `EWSConfig` vs `Config`

## Анализ логов

Все 6 лог-файлов показывают идентичную ошибку:

- Приложение успешно запускается (Prometheus на порту 9108, Health check на 9109)
- Ошибка возникает на этапе "ingest" при попытке подключения к EWS
- Стек вызовов: `run.py` → `ews.py:fetch_messages()` → `ews.py:_connect()` → ошибка на строке 65

## Приоритет исправлений

1. **Высокий:** Исправить вызов метода в `ews.py:65` (блокирует работу приложения)
2. **Средний:** Настроить переменные окружения (требуется для работы после исправления кода)
3. **Низкий:** Установить инструменты разработки (требуется только для разработки)

### To-dos

- [ ] Исправить вызов метода get_ews_password() на get_password() в ews.py:65
- [ ] Проверить весь код на наличие других неправильных вызовов get_ews_password()
- [ ] Добавить unit-тесты для методов EWSConfig и Config
- [ ] Обновить документацию по использованию методов конфигурации