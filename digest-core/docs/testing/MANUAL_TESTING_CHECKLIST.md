# Чек-лист ручного тестирования SummaryLLM

## Обзор

Этот чек-лист поможет вам систематически протестировать SummaryLLM на корпоративном ноутбуке. Следуйте этапам по порядку и отмечайте выполненные пункты.

## Этап 1: Подготовка окружения

### 1.1 Установка зависимостей
- [ ] Клонировать репозиторий
- [ ] Перейти в директорию `digest-core`
- [ ] Выполнить `make setup` или `uv sync`
- [ ] Проверить установку: `python3 -m digest_core.cli --help`

### 1.2 Настройка переменных окружения
- [ ] Установить `EWS_PASSWORD` (пароль от Exchange)
- [ ] Установить `EWS_USER_UPN` (email в формате user@corp.com)
- [ ] Установить `LLM_TOKEN` (токен для LLM Gateway)
- [ ] Проверить переменные: `./scripts/print_env.sh`

### 1.3 Проверка доступа к сервисам
- [ ] Проверить доступ к Exchange серверу
- [ ] Проверить доступ к LLM Gateway
- [ ] Проверить корпоративный CA сертификат (если требуется)

### 1.4 Настройка конфигурации
- [ ] Скопировать `configs/config.example.yaml` в `configs/config.yaml`
- [ ] Обновить настройки EWS (endpoint, user_upn)
- [ ] Обновить настройки LLM (endpoint, model)
- [ ] Проверить настройки временной зоны

## Этап 2: Smoke тесты

### 2.1 Dry-run без LLM
- [ ] Запустить: `python3 -m digest_core.cli run --dry-run`
- [ ] Проверить, что команда завершилась с кодом 2 (ожидаемый результат)
- [ ] Убедиться, что нет ошибок конфигурации
- [ ] Проверить создание директорий для вывода

### 2.2 Проверка EWS подключения
- [ ] Запустить тест подключения к Exchange
- [ ] Проверить аутентификацию
- [ ] Убедиться, что можно получить список папок
- [ ] Проверить доступ к папке Inbox

### 2.3 Проверка нормализации писем
- [ ] Запустить dry-run с реальными письмами
- [ ] Проверить обработку HTML писем
- [ ] Проверить удаление цитат
- [ ] Убедиться в корректной обработке кодировок

## Этап 3: Интеграционные тесты

### 3.1 Полный запуск с реальными данными
- [ ] Запустить: `./scripts/test_run.sh`
- [ ] Дождаться завершения процесса
- [ ] Проверить создание файлов дайджеста
- [ ] Убедиться в отсутствии критических ошибок

### 3.2 Проверка генерации дайджеста
- [ ] Проверить создание JSON файла дайджеста
- [ ] Проверить создание Markdown файла дайджеста
- [ ] Убедиться в корректности структуры данных
- [ ] Проверить наличие секций и элементов действий

### 3.3 Проверка метрик
- [ ] Проверить доступность Prometheus метрик на порту 9108
- [ ] Убедиться в наличии метрик LLM запросов
- [ ] Проверить метрики обработки писем
- [ ] Проверить метрики времени выполнения

## Этап 4: Тесты граничных случаев

### 4.1 Пустой день (нет писем)
- [ ] Запустить дайджест для дня без писем
- [ ] Проверить корректную обработку пустого результата
- [ ] Убедиться в создании пустого дайджеста
- [ ] Проверить отсутствие ошибок

### 4.2 Большой объем писем (>100)
- [ ] Запустить дайджест для дня с большим количеством писем
- [ ] Проверить производительность обработки
- [ ] Убедиться в корректной пагинации
- [ ] Проверить использование памяти

### 4.3 Письма с кириллицей
- [ ] Найти письма с русским текстом
- [ ] Запустить обработку таких писем
- [ ] Проверить корректность кодировки
- [ ] Убедиться в правильном отображении в дайджесте

### 4.4 Письма с вложениями
- [ ] Найти письма с вложениями
- [ ] Проверить обработку таких писем
- [ ] Убедиться в корректной обработке метаданных
- [ ] Проверить, что вложения не влияют на обработку

## Этап 5: Проверка качества

### 5.1 Проверка PII маскирования
- [ ] Проверить, что email адреса маскируются в логах
- [ ] Убедиться в маскировании имен в дайджесте
- [ ] Проверить отсутствие чувствительных данных в выводе
- [ ] Убедиться в корректности формата маскирования

### 5.2 Проверка точности извлечения
- [ ] Сравнить извлеченные действия с реальными письмами
- [ ] Проверить корректность дат дедлайнов
- [ ] Убедиться в правильности определения ответственных
- [ ] Проверить уровень уверенности (confidence) в результатах

### 5.3 Проверка производительности
- [ ] Измерить время выполнения полного цикла
- [ ] Проверить использование памяти
- [ ] Убедиться в разумном времени отклика LLM
- [ ] Проверить эффективность обработки больших объемов

## Этап 6: Сбор диагностики

### 6.1 Автоматический сбор
- [ ] Запустить `./scripts/collect_diagnostics.sh`
- [ ] Дождаться создания архива диагностики
- [ ] Проверить размер и содержимое архива
- [ ] Убедиться в наличии всех необходимых файлов

### 6.2 Проверка содержимого архива
- [ ] Проверить наличие логов приложения
- [ ] Убедиться в наличии метрик Prometheus
- [ ] Проверить конфигурацию (без секретов)
- [ ] Убедиться в наличии системной информации

## Этап 7: Отправка результатов

### 7.1 Подготовка к отправке
- [ ] Найти созданный архив диагностики
- [ ] Проверить размер архива (< 25MB для email)
- [ ] Подготовить описание проблем (если есть)
- [ ] Собрать скриншоты ошибок (если есть)

### 7.2 Отправка через корпоративную почту
- [ ] Создать новое письмо
- [ ] Указать тему: "SummaryLLM Diagnostics - [дата]"
- [ ] Прикрепить архив диагностики
- [ ] Описать выполненные тесты и найденные проблемы
- [ ] Отправить письмо

## Шаблон отчета

При отправке результатов используйте следующий шаблон:

```
Тема: SummaryLLM Diagnostics - 2024-01-15

Здравствуйте!

Провел тестирование SummaryLLM на корпоративном ноутбуке.

Выполненные тесты:
✓ Подготовка окружения
✓ Smoke тесты (dry-run)
✓ Интеграционные тесты
✓ Тесты граничных случаев
✓ Проверка качества

Найденные проблемы:
- [описать проблемы, если есть]

Результаты:
- Время выполнения: [указать время]
- Обработано писем: [количество]
- Создано действий: [количество]
- Размер дайджеста: [размер файлов]

Прикреплен архив диагностики: diagnostics-[timestamp].tar.gz

С уважением,
[Ваше имя]
```

## Полезные команды

```bash
# Быстрый запуск всех тестов
./scripts/test_run.sh

# Только диагностика окружения
./scripts/print_env.sh

# Только сбор диагностики
./scripts/collect_diagnostics.sh

# Проверка метрик
curl http://localhost:9108/metrics

# Проверка логов
tail -f ~/.digest-logs/run-*.log
```

## Контакты для поддержки

При возникновении проблем:
1. Сначала выполните все этапы чек-листа
2. Соберите диагностику с помощью скрипта
3. Отправьте результаты через корпоративную почту
4. Укажите конкретные ошибки и шаги для воспроизведения
